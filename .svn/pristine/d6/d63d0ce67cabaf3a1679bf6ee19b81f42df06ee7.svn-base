 /* * @author:wanglei * @date:13/12/2 * @name:实现多行省略 * *///============使用jquery扩展定义多行缩略，支持IE7浏览器=============$.fn.extend({    getText: function() {        if (this[0].innerText == undefined) {            return this[0].textContent;        } else {            return this[0].innerHTML;        }    },    setText: function(str) {        if (this[0].innerText == undefined) {            this[0].textContent = str || "";        } else {            this[0].innerHTML = str || "";        }    },    getFinalStyle: function(property, fontSize) {        var s;        if (window.getComputedStyle) {            s = window.getComputedStyle(this[0], null)[property];        } else {            s = this[0].currentStyle[property];        }        return s.substring(0, s.toString().length - 2);        },    /**	 * row	要缩略的行数	 */    mlellipsis: function(row) {        var lineHeight = null;        var element = this;        //获取计算后的样式        var fontSize = $(element).getFinalStyle("fontSize");        if (/msie/i.test(navigator.userAgent)) {            lineHeight = $(element).getFinalStyle("lineHeight", fontSize);        } else {            lineHeight = $(element).getFinalStyle("lineHeight");        }        var height = element[0].clientHeight;                if (lineHeight == "1") {            lineHeight = Number(fontSize * 1.5);            $(element).css("line-height", lineHeight + "px");        } else {            lineHeight = Number(lineHeight);        }        // 当前微博div        var $thisDiv = $(element);        var $nextDiv = $thisDiv.next();                // 处理源内容@        $($nextDiv.get(0)).at();        //若高度足够，则不用省略        var dheight = Math.floor(row * lineHeight);        var $imgs = $("img[alt='贴图']", $thisDiv);        var $newImgs = $imgs.clone(true);        var $sourceImgs = $("img[alt='贴图']", $nextDiv);        $imgs.remove();                var openClickEvent = function() {            _bandOpen();        };        if (height > dheight || $newImgs.length > 0) {            str = $(element).getText();            while (dheight < element[0].clientHeight) {                $(element).setText(str.substring(0, str.length / 2));                str = $(element).getText();            }                        var elementCont = $(element).getText();            if (height > dheight) {                elementCont = elementCont + " ...";            }            this.setText(elementCont);                        var $showSpan = $('<span class="show_div"><i></i>展开</span>').click(function() {                openClickEvent();            });                        var $hideSpan = $('<span class="hide_div"><i></i>收起</span>').click(function() {                _bandClose();            });            // 处理隐藏过的内容 @符号            $(element).at();            $thisDiv.append($showSpan);            $nextDiv.append($hideSpan);            if (height <= dheight) {                _hideExpand($thisDiv);            }            //渲染第一张缩略图            if ($newImgs.length > 0) {                var $this = $($newImgs[0]), url = $this.attr("src");                $this.attr("src", url.replace("!custom", "!thumbFile"));                $this.addClass("show-all");                $this.click(function() {                    _bandOpen();                });                $thisDiv.append($this);            }            // 查看原图            $sourceImgs.each(function() {                var $this = $(this);                var src = $this.attr("src");                src = src.substring(0, src.indexOf("!custom"));                $this.after('<a class="zoom" href="' + src + '" target="_blank" style="width:80px;"><i></i><span>查看原图</span></a>');                $this.addClass("postSourceImg");                $this.click(function() {                    _bandClose();                });            });            function _bandOpen() {                // 隐藏缩略内容                $thisDiv.hide();                // 显示原始内容                $nextDiv.show();            }            ;            function _bandClose() {                // 显示缩略内容                $thisDiv.show();                // 隐藏原始内容                $nextDiv.hide();            }            ;        } else {            // 处理隐藏过的内容 @符号            $(element).at();        }    }});function _hideExpand($thisDiv) {    $thisDiv.find(".show_div").hide();}